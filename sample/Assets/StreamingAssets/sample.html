<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Unity WebView</title>
    <script src="sample.js"></script>
    <script>
      window.addEventListener(
          'load',
          function() {
              window.requestCameraApproved = false;
              var oldGM = window.navigator.mediaDevices.getUserMedia.bind(window.navigator.mediaDevices);
              var retry = 0;
              window.navigator.mediaDevices.getUserMedia = function(constraints) {
                  Unity.call("RequestCamera");
                  return new Promise(function(resolve, reject) {
                      var wait = function() {
                          if (window.requestCameraApproved) {
                              oldGM(constraints).then(resolve).catch(reject);
                          } else if (retry++ < 20) {
                              setTimeout(wait, 1000);
                          }
                      };
                      wait();
                  });
              };
              var button = document.getElementById('videobutton');
              button.addEventListener(
                  'click',
                  function() {
                      RequestCameraApproved();
                  });
          });
      function RequestCameraApproved() {
          // cf. https://www.aedi.jp/work/webrtc/
          var constraints = { audio: true, video: { facingMode: "user" } };
          navigator.mediaDevices
              .getUserMedia(constraints)
              .then(function(mediaStream) {
                  var video = document.querySelector('video');
                  video.srcObject = mediaStream;
                  video.onloadedmetadata = function(e) {
                      video.play();
                  };
              })
              .catch(function(err) { console.log(err.name + ": " + err.message); });
      }
    </script>
    <!-- geolocation example
    <script>
      window.addEventListener(
        'load',
        function() {
          if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(function(position) {
              document.getElementById('msg').innerHTML = '[' + position.coords.latitude + ', ' + position.coords.longitude + ']';
            });
          }
        });
    </script>
    -->
  </head>
  <body>
    <h1>Hello Unity WebView!</h1>
    <hr/>
    <p><a href="https://google.com">https://google.com</a> (for testing go/back buttons)</p>
    <p><a href="http://httpbin.org/headers">http://httpbin.org/headers</a> (for testing custom headers.)</p>
    <p><img id="img" src="sample.jpg"/> (local image)</p>
    <p><a href="javascript:void(0)" onclick="testSaveDataURL();">Test saveDataURL</a> (experimental, only for Android/iOS)</p>
    <hr/>
    <div id="msg">[]</div>
    <p><a href="javascript:void(0)" onclick="Unity.call('anchor');">[Send Message!]</a></p>
    <form method="get" action="form">
      <input id="input1" type="text" value="hoge" name="msg"/>
      <input type="submit" value="Send Message!" onclick="Unity.call('form?msg=' + document.getElementById('input1').value); return false;"/><br/>
      <input type="file" name="datafile"/>
    </form>
    <button id="videobutton">Turn on Camera</button><br>
    <video id="video" autoplay playsinline></video>
  </body>
</html>
